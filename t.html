<html>
<head>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
	<style>
		* {
			margin:0;
			padding:0;
		}
		.blockCol{
            display: table-cell;
            border: 1px solid black;
			box-sizing: border-box;
			-moz-box-sizing: border-box;
			-webkit-box-sizing: border-box;
		}
        .blockRow{
            display:table-row;
        }
		#container{
			margin:0 auto;
            display: table;
            --border-collapse:collapse;
		}
		.blockCol.forbidden{
			background-color:#000;
		}
		.blockCol.pass-2{
			background-color:#c0c0c0;
		}
		.blockCol.pass-1{
			background-color:#ccc;
		}
		.blockCol.disabledBlock{
			background-color:transparent;
		}
        .blockCol.normalBlock{
			background-color:#eee;
		}
        .blockCol.startBlock{
			background-color:#0000aa;
		}
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script>
        Math.norm = Math.norm ||(function(){
            return function(num) {
                var round = Math.round(num);
                var floor = Math.floor(num);
                if(round > floor) 
                    return round - 0.5;

                return floor;
            }
        })()

        
        
        
        var G_ActualTouchedEl;
        var G_IsStarted = false;
        
		function block(posX, posY, type, timesToDisable){
			this.posX = posX;
			this.posY = posY;
            this.type = type;
			this.timesToDisable = timesToDisable;
            
            return this;
		}
		
		function board(){
			var addBlocks = function(x,y){
                var container = $('#container');
				var winWidth = $(container).width();
				var winHeight = $(container).height();
				var blockWidth = Math.norm(winWidth / x); //Arredondar isso
				var blockHeight = Math.norm(winHeight / y); //Arredondar isso
                var blockSize;
                
                if(winWidth > winHeight){
				    blockSize = blockWidth < blockHeight ? blockWidth : blockHeight;
                }else{
                     blockSize = blockWidth > blockHeight ? blockWidth : blockHeight;
                }
				//var conainerWidth = blockSize*x;
				//var conainerHeight = blockSize*y;
				
				
					
				var blockCell;
				var blockRow;
                
				for(var xx=0; xx<x; xx++){
                    blockRow = $('<div>')
                        .addClass('blockRow')
                        .appendTo(container);
                    
					for(var yy=0; yy<y; yy++){
						blockCell = $('<div>')
							.css({
								'width':blockSize + 'px',
								'height':blockSize + 'px'
							})
							.addClass('blockCol')
                            .addClass('normalBlock')
                            .data("blockType","normalBlock")
							.attr('id','block-' + xx + '-' + yy)
							.data("timesToDisable",1)
                            .appendTo(blockRow);
					}
                    
				}
			};
            
            var addChallengeBlocks = function(blocks){
				$(blocks).each(function(){
					var block = this;
                    var typeClass;
                    var objectId = '#block-'+block.posX+'-'+block.posY;

                    switch(block.type){
                        case 'forbiddenBlock':
                            typeClass = 'forbidden';
                            break;
                        case 'passBlock':
                            typeClass = 'pass-' + block.timesToDisable;
                            break;
                    }
                    
                    $(objectId).removeClass("normalBlock");
                    $(objectId).addClass(typeClass);
					$(objectId).data("blockType",block.type);
					$(objectId).data("timesToDisable",block.timesToDisable);
                });
            };
            
            var addStartBlock = function(blocks){
                $(blocks).each(function(){
                    var block = this;
                    var objectId = '#block-'+block.posX+'-'+block.posY;
                    
                    $(objectId).removeClass("normalBlock");
                    $(objectId).addClass("startBlock");
                    $(objectId).data("blockType","startBlock");
                });
            }
			
			//public
			this.addBlocks = addBlocks;
			this.addChallengeBlocks = addChallengeBlocks;
            this.addStartBlock = addStartBlock;
		}
		
        
        function game(){
			var bindEvents = function(){
				$('body')
					.bind('touchend touchcancel', function(){
						gameOver(); 
					});
					
				$('.blockCol')
					.bind('touchmove touchstart', function(e){
						var touch = e.originalEvent.touches[0];
						var x = touch.clientX;
						var y = touch.clientY;
						
						$('.blockCol').each(function() {
                            var _this = $(this);
							// check if is inside boundaries
							if (!(
								x <= _this.offset().left || x >= _this.offset().left + _this.outerWidth() ||
								y <= _this.offset().top  || y >= _this.offset().top + _this.outerHeight()
							)) {
                                if(_this.attr("id") != G_ActualTouchedEl){
								    blockAction(this);
                                    G_ActualTouchedEl = _this.attr("id");
                                }
							}
						});
					});
			}

			
			var blockAction = function(blockO){
				var o = $(blockO);
				var blockType = o.data("blockType");
				var timesToDisable = o.data("timesToDisable");
				
                if(blockType == 'startBlock' || G_IsStarted == true){
                    switch(blockType){
                        case 'forbiddenBlock':
                            gameOver();
                            break;
                        case 'passBlock':
                            var actualClass = 'pass-' + timesToDisable;
                            var nextClass;

                            if(timesToDisable == 1){
                                nextClass = 'disabledBlock';
                                o.data("blockType", "disabled");
                            }else{
                                nextClass = 'pass-' + (timesToDisable - 1);
                                o.data("timesToDisable", timesToDisable - 1);
                            }

                            o.removeClass(actualClass);
                            o.addClass(nextClass);

                            break;
                        case 'disabled':
                            gameOver();
                            break;
                        case 'normalBlock':
                            o.removeClass("normalBlock");
                            o.addClass("disabled");
                            o.data("blockType", "disabled");
                            break;
                        case 'startBlock':
                            o.removeClass("startBlock");
                            o.addClass("disabled");
                            o.data("blockType", "disabled");
                            G_IsStarted = true;
                            break;

                    }
                }else{
                    gameOver();
                }
			}
            
            var gameOver = function(){
                alert('game over');
            }
            
			var start = function(){
                $('#container').width($(window).width());
                $('#container').height($(window).height());
				var gameBoard = new board();
				var gameBlocks = new Array();
                var startGameBlocks = new Array();
                
				gameBlocks.push(new block(0,0,'forbiddenBlock'));
				gameBlocks.push(new block(1,0,'forbiddenBlock'));
				gameBlocks.push(new block(1,1,'passBlock',1));
				gameBlocks.push(new block(2,1,'passBlock',2));
				
				startGameBlocks.push(new block(4,1));
				
				gameBoard.addBlocks(15,6);
				gameBoard.addChallengeBlocks(gameBlocks);
                gameBoard.addStartBlock(startGameBlocks);
                
				bindEvents();
			}
			


			this.start = start;
        }
		
		
		$(document).ready(function(){
            var gameO = new game();
			gameO.start();
		});
	</script>
</head>
<body>
    <div id="container">
    </div>
</body>
</html>